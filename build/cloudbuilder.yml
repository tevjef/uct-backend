steps:
  - name: 'gcr.io/universitycoursetracker/firebase'
    args: ['deploy', '--config=firebase/firebase.json','--project=universitycoursetracker', '--only=hosting']
  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'functions',
            'deploy',
            'spike',
            '--source=https://source.developers.google.com/projects/universitycoursetracker/repos/github_tevjef_uct-backend/moveable-aliases/develop_firebase',
            '--trigger-http',
            '--allow-unauthenticated',
            '--memory=128',
            '--runtime=go113',
            '--entry-point=Spike'
    ]
  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'functions',
            'deploy',
            'hermes',
            '--source',
            'https://source.developers.google.com/projects/universitycoursetracker/repos/github_tevjef_uct-backend/moveable-aliases/develop_firebase',
            '--trigger-event',
            'providers/cloud.firestore/eventTypes/document.update',
            '--trigger-resource',
            'projects/universitycoursetracker/databases/(default)/documents/section.topicName/{topicName}',
            '--memory',
            '128',
            '--runtime',
            'go113',
            '--entry-point',
            'Hermes'
    ]
  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'functions',
            'deploy',
            'ein',
            '--source',
            'https://source.developers.google.com/projects/universitycoursetracker/repos/github_tevjef_uct-backend/moveable-aliases/develop_firebase',
            '--trigger-http',
            '--memory',
            '256',
            '--timeout',
            '120',
            '--runtime',
            'go113',
            '--entry-point',
            'Ein',
            '--set-env-vars',
            'EIN_INPUT_FORMAT=protobuf'
    ]
  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'functions',
            'deploy',
            'rutgers-nb',
            '--source',
            'https://source.developers.google.com/projects/universitycoursetracker/repos/github_tevjef_uct-backend/moveable-aliases/develop_firebase',
            '--trigger-http',
            '--memory',
            '256',
            '--runtime',
            'go113',
            '--entry-point',
            'RutgersScraper',
            '--set-env-vars',
            'RUTGERS_CAMPUS=NB,OUTPUT_HTTP_URL=https://us-central1-universitycoursetracker.cloudfunctions.net/ein'
    ]
  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'functions',
            'deploy',
            'rutgers-nk',
            '--source',
            'https://source.developers.google.com/projects/universitycoursetracker/repos/github_tevjef_uct-backend/moveable-aliases/develop_firebase',
            '--trigger-http',
            '--memory',
            '128',
            '--runtime',
            'go113',
            '--entry-point',
            'RutgersScraper',
            '--set-env-vars',
            'RUTGERS_CAMPUS=NK,OUTPUT_HTTP_URL=https://us-central1-universitycoursetracker.cloudfunctions.net/ein'
    ]
  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'functions',
            'deploy',
            'rutgers-cm',
            '--source',
            'https://source.developers.google.com/projects/universitycoursetracker/repos/github_tevjef_uct-backend/moveable-aliases/develop_firebase',
            '--trigger-http',
            '--memory',
            '128',
            '--runtime',
            'go113',
            '--entry-point',
            'RutgersScraper',
            '--set-env-vars',
            'RUTGERS_CAMPUS=CM,OUTPUT_HTTP_URL=https://us-central1-universitycoursetracker.cloudfunctions.net/ein'
    ]
timeout: 30m